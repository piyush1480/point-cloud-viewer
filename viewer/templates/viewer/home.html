{% comment %} <!DOCTYPE html>
<html>
<head>
    <title>3D Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body class="p-4">
<nav class="navbar navbar-dark bg-dark mb-4">
  <span class="navbar-brand ms-3">3D Point Cloud Viewer</span>
</nav>

<div class="container">
  <form method="POST" enctype="multipart/form-data" class="mb-4">
    {% csrf_token %}
    {{ form.as_p }}
    <button class="btn btn-primary">Upload</button>
  </form>

  {% if file_url %}
    <h5>Rendered Viewer</h5>
    <div id="viewer" style="width:100%; height:500px; background:#222;"></div>

    <script>
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth*0.9, 500);
      document.getElementById('viewer').appendChild(renderer.domElement);

      fetch("{{ file_url }}")
        .then(res => res.text())
        .then(data => {
          const geometry = new THREE.BufferGeometry();
          const points = [];

          data.split("\n").forEach(line=>{
              const p=line.trim().split(" ");
              if(p.length>=3) points.push(parseFloat(p[0]),parseFloat(p[1]),parseFloat(p[2]));
          });

          geometry.setAttribute('position', new THREE.Float32BufferAttribute(points,3));
          const cloud = new THREE.Points(geometry, new THREE.PointsMaterial({size:0.05}));
          scene.add(cloud);

          camera.position.z = 4;
          function animate(){
            requestAnimationFrame(animate);
            cloud.rotation.y += 0.001;
            renderer.render(scene, camera);
          }
          animate();
        });
    </script>
  {% endif %}
</div>
</body>
</html> {% endcomment %}



<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <title>3D Viewer</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Your CSS -->
    <link rel="stylesheet" href="{% static 'css/viewer.css' %}">

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>

<body class="p-4">
<nav class="navbar navbar-dark bg-dark mb-4">
  <span class="navbar-brand ms-3">3D Point Cloud Viewer</span>
</nav>

<div class="container">
  <form method="POST" enctype="multipart/form-data" class="mb-4">
    {% csrf_token %}
    {{ form.as_p }}
    <button class="btn btn-primary">Upload</button>
  </form>

  {% if file_url %}
    <h5>Rendered Viewer</h5>
    <div id="viewer"></div>
  {% endif %}
</div>

<!-- Your JS -->
<script src="{% static 'js/viewer.js' %}"></script>

{% if file_url %}
<script>
    initPointCloudViewer("{{ file_url }}");
</script>
{% endif %}

</body>
</html>
